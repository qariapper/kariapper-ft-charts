<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Kariapper Family Tree – up to 3 generations--- ver6</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  


  <!-- Tabletop.js from cdnjs (correct path!) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop/1.5.4/tabletop.min.js"></script>

  <!-- Google Charts -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>

  
  <style>
    html, body { margin:0; padding:0; height:100%; }
    h1 { text-align:center; margin:12px 0; font-family:sans-serif; }
    #tree_div {
      width:100%;
      height:calc(100% - 48px);
      overflow:auto;
      box-sizing:border-box;
      padding:10px;
    }
    .org-node {
      padding:4px 8px;
      border-radius:4px;
      border:1px solid #666;
      background:#f9f9f9;
      font-family:Arial, sans-serif;
      text-align:center;
    }
  </style>
</head>
<body>
  <h1>Kariapper Family Tree – up to 3 generations---- ver6</h1>
  <div id="tree_div">Loading…</div>

  <script>
    // 1) Load OrgChart
    google.charts.load('current', { packages:['orgchart'] });
    google.charts.setOnLoadCallback(fetchAndDraw);

    // 2) Fetch only the "MasterSheet" tab
    function fetchAndDraw() {
      Tabletop.init({
        key: 'https://docs.google.com/spreadsheets/d/1BE7PJAJs3QxHnOsb1z5cKnGHdjQCR8IksorMcAm7Fx8/pubhtml',
        callback: buildChart,
        simpleSheet: false,           // turn off the single-sheet shortcut
        wanted: ['Master']       // <-- name of your tab
      });
    }

    // 3) Build chart from that one sheet
    function buildChart(data, tabletop) {
      // get rows from the MasterSheet tab
      const rows = tabletop.sheets('MasterSheet').all();

      const dataTable = new google.visualization.DataTable();
      dataTable.addColumn('string','Node');
      dataTable.addColumn('string','Parent');
      dataTable.addColumn({ type:'string', role:'tooltip', p:{ html:true } });

      rows.forEach(r => {
        const gen = Number(r.Generation);
        if (gen > 3) return;

        const id      = (r.dID      || '').trim();
        const parent  = (r.Father_dID|| '').trim();
        const name    = r.FullName;
        const spouses = [r.SpouseF, r.SpouseM].filter(s=>s).join(', ');

        const nodeF = `<div class="org-node">${name}</div>`;
        const tip   = `<div style="padding:6px;">
                         <strong>${name}</strong>
                         ${spouses?`<br/><em>Spouse(s):</em> ${spouses}`:''}
                       </div>`;

        dataTable.addRow([{ v:id, f:nodeF }, parent, tip]);
      });

      // 4) Draw OrgChart – default top-down layout
      const chart = new google.visualization.OrgChart(
        document.getElementById('tree_div')
      );
      chart.draw(dataTable, {
        allowHtml:    true,
        allowCollapse:true,
        compactRows:  true
      });
    }
  </script>
</body>
</html>
